<!DOCTYPE html>
<html>
<head>
    <title>Student Login - ALIET</title>
    <style>
        /* Centering the card perfectly */
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            background: #f0f2f5; 
            margin: 0; 
        }
        .login-box { 
            background: #fff; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
            width: 320px; 
            text-align: center;
        }
        h2 { color: #333; margin-top: 0; }
        input { 
            display: block; 
            margin: 10px auto; 
            padding: 12px; 
            width: 100%; 
            border: 1px solid #ccc; 
            border-radius: 6px; 
            box-sizing: border-box; 
        }
        
        /* Show Password Row */
        .show-pass-container { 
            display: flex; 
            align-items: center; 
            font-size: 14px; 
            margin: 5px 0 15px 5px; 
            color: #444; 
        }
        .show-pass-container input { width: auto; margin: 0 10px 0 0; cursor: pointer; }
        
        button { 
            padding: 12px 20px; 
            background: #1a73e8; 
            color: white; 
            border: none; 
            cursor: pointer; 
            border-radius: 6px; 
            font-weight: bold; 
            width: 100%; 
            font-size: 16px;
        }
        button:hover { background: #1557b0; }
        .back { display:block; margin-top:15px; text-decoration:none; color:#666; font-size:14px; }
        .register-link { margin-top: 15px; font-size: 14px; }
        .register-link a { color: #1a73e8; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>
    <div class="login-box">
        <h2>Student Login</h2>
        
        <input type="text" id="rollNo" placeholder="Roll Number (e.g. 22A81A...)">
        
        <input type="password" id="password" placeholder="Password">
        
        <div class="show-pass-container">
            <input type="checkbox" id="showPass" onclick="togglePassword()"> 
            <label for="showPass" style="cursor:pointer;">Show Password</label>
        </div>

        <button id="loginBtn">Login as Student</button>
        
        <div class="register-link">
            New Student? <a href="register.html">Register Here</a>
        </div>
        
        <a href="index.html" class="back">‚Üê Back to Selection</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

        // Your project's secure config
        const firebaseConfig = {
            apiKey: "AIzaSyAIgVYLQ-OXUwNtnGvgmY5VtcLr6rqx5Fw",
            authDomain: "student-strategy-app.firebaseapp.com",
            projectId: "student-strategy-app"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Toggle Password Function
        window.togglePassword = () => {
            const passwordField = document.getElementById("password");
            passwordField.type = passwordField.type === "password" ? "text" : "password";
        };

        document.getElementById('loginBtn').addEventListener('click', async () => {
            const rollNo = document.getElementById('rollNo').value.toUpperCase().trim();
            const password = document.getElementById('password').value;

            if (!rollNo || !password) {
                alert("Please enter both Roll Number and Password");
                return;
            }

            // Creating the hidden email for Firebase Auth
            const hiddenEmail = rollNo + "@aliet-strategy.com";

            try {
                const userCredential = await signInWithEmailAndPassword(auth, hiddenEmail, password);
                const userDoc = await getDoc(doc(db, "students", rollNo));

                if (userDoc.exists()) {
                    alert("Login Successful! Welcome " + userDoc.data().name);
                    window.location.href = "studentdashboard.html"; 
                } else {
                    alert("Profile data not found.");
                }
            } catch (error) { 
                alert("Login Error: " + error.message);
            }
        });
    </script>
</body>
</html>